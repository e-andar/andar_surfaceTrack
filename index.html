<!DOCTYPE html>
<html>
<head>
  <title>3D Models on Surface</title>
  <meta name="description" content="A-Frame AR with plane detection and glTF model placement.">
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-ar-hit-test-component@0.2.0/dist/aframe-ar-hit-test-component.min.js"></script>
</head>
<body>
  <a-scene
    webxr="requiredFeatures: hit-test, plane-detection; optionalFeatures: dom-overlay; overlayElement: #ar-ui"
    ar-hit-test="target: #reticle; type: plane"
    renderer="colorManagement: true">

    <a-assets>
      <a-asset-item id="sunflower" src="./SunflowerGarden.glb"></a-asset-item>
    </a-assets>

    <a-camera></a-camera>
    <a-light type="ambient" color="#fff" intensity="0.7"></a-light>
    <a-light type="directional" position="0 5 2" intensity="0.8"></a-light>

    <a-entity ar-plane-detector></a-entity>
    <a-entity id="reticle"
      geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.08"
      material="color: #FFC107; shader: flat"
      rotation="-90 0 0">
    </a-entity>

    <a-entity id="model-to-place" gltf-model="#sunflower" visible="false" scale="0 0 0"></a-entity>

  </a-scene>

  <div id="ar-ui" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); color: white; display: flex; justify-content: center; align-items: center; text-align: center; font-family: sans-serif;">
    <div>
      <h2>AR Experience</h2>
      <p>Point your camera at a flat surface to begin.</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sceneEl = document.querySelector('a-scene');
      const reticle = document.querySelector('#reticle');
      const arUi = document.querySelector('#ar-ui');

      // Hide the UI when we enter AR
      sceneEl.addEventListener('enter-vr', () => {
        arUi.style.display = 'none';
      });

      // Place the model when the reticle is clicked
      reticle.addEventListener('click', () => {
        // Create a new entity for the placed model
        const newModel = document.createElement('a-entity');
        newModel.setAttribute('gltf-model', '#sunflower');

        // Get the position and rotation from the reticle
        const position = reticle.getAttribute('position');
        const rotation = reticle.getAttribute('rotation');

        newModel.setAttribute('position', position);
        // We often want the model to stand upright, regardless of the plane's angle.
        // You can use the reticle's rotation directly if you want it to align with the surface.
        newModel.setAttribute('rotation', `0 ${rotation.y} 0`);
        newModel.setAttribute('scale', '0.3 0.3 0.3');

        // Add the new model to the scene
        sceneEl.appendChild(newModel);
      });
    });
  </script>
</body>
</html>